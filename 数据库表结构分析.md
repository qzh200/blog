# 📊 BBS论坛系统数据库表结构分析

**分析日期：** 2025年11月1日  
**数据库：** bbs-pro (MySQL 8.0)  
**总表数：** 140+ 张表  
**数据库文件：** bbs-.sql

---

## 目录

- [1. 概述](#1-概述)
- [2. 核心业务模块](#2-核心业务模块)
  - [2.1 用户系统模块](#21-用户系统模块)
  - [2.2 话题/帖子系统](#22-话题帖子系统)
  - [2.3 评论回复系统](#23-评论回复系统)
  - [2.4 问答系统](#24-问答系统)
  - [2.5 社交系统](#25-社交系统)
  - [2.6 消息通知系统](#26-消息通知系统)
  - [2.7 支付金融系统](#27-支付金融系统)
  - [2.8 内容管理系统](#28-内容管理系统)
  - [2.9 系统管理模块](#29-系统管理模块)
  - [2.10 第三方集成模块](#210-第三方集成模块)
  - [2.11 内容安全模块](#211-内容安全模块)
  - [2.12 媒体处理模块](#212-媒体处理模块)
  - [2.13 统计分析模块](#213-统计分析模块)
- [3. 数据库设计特点](#3-数据库设计特点)
- [4. 表数量统计](#4-表数量统计)
- [5. 核心表结构详解](#5-核心表结构详解)
- [6. 数据备份建议](#6-数据备份建议)

---

## 1. 概述

这是一个功能完整的BBS论坛系统，采用MySQL 8.0数据库，使用utf8mb4字符集，支持emoji和特殊字符。系统包含用户管理、话题讨论、问答社区、社交互动、支付金融等完整功能模块。

**技术特点：**
- 水平分表策略：高频表分成4张(_0, _1, _2, _3)
- 完善的索引设计：主键、唯一键、组合索引
- RBAC权限模型：用户-角色-权限-资源
- 支持Markdown：话题和问题支持Markdown格式
- 金融功能：积分、红包、会员卡系统

---

## 2. 核心业务模块

### 2.1 用户系统模块

**表数量：** 10张表

| 表名 | 功能说明 | 分表 |
|------|---------|------|
| `user` | 用户主表，存储用户基本信息 | 否 |
| `usercustom` | 用户自定义字段配置 | 否 |
| `userdynamic_0~3` | 用户动态记录（发帖、回复等） | 是(4张) |
| `userrole` | 用户角色定义 | 否 |
| `userrolegroup` | 用户角色组 | 否 |
| `usergrade` | 用户等级体系 | 否 |
| `userinputvalue` | 用户自定义字段值 | 否 |
| `userloginlog_0~3` | 用户登录日志 | 是(4张) |

**user表核心字段：**
```sql
CREATE TABLE `user` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `account` varchar(65) NULL UNIQUE,           -- 账号（唯一）
  `userName` varchar(30) NULL,                 -- 用户名
  `nickname` varchar(50) NULL,                 -- 昵称
  `email` varchar(100) NULL,                   -- 邮箱
  `mobile` varchar(20) NULL,                   -- 手机号
  `password` varchar(160) NULL,                -- 密码（加密）
  `salt` varchar(80) NULL,                     -- 密码盐
  `point` bigint NULL,                         -- 积分
  `deposit` decimal(14,4) NULL,                -- 保证金
  `state` int NULL,                            -- 状态（1-正常）
  `type` int NULL,                             -- 类型（10-普通用户）
  `registrationDate` datetime(6) NULL,         -- 注册时间
  `realNameAuthentication` bit(1) NOT NULL,    -- 是否实名认证
  `platformUserId` varchar(90) NULL UNIQUE,    -- 第三方平台用户ID
  `cancelAccountTime` bigint NULL,             -- 注销时间
  PRIMARY KEY (`id`)
);
```

**关键特性：**
- ✅ 支持账号/手机/邮箱多方式登录
- ✅ 积分体系（point字段）
- ✅ 保证金机制（deposit字段）
- ✅ 实名认证（realNameAuthentication）
- ✅ 第三方平台登录（platformUserId）
- ✅ 用户动态按4张表分表存储

---

### 2.2 话题/帖子系统

**表数量：** 20+张表

| 表名 | 功能说明 | 分表 |
|------|---------|------|
| `topic` | 话题主表 | 否 |
| `topicindex` | 话题全文搜索索引 | 否 |
| `topiclike_0~3` | 话题点赞记录 | 是(4张) |
| `topicfavorite_0~3` | 话题收藏记录 | 是(4张) |
| `topicunhide_0~3` | 话题取消隐藏记录 | 是(4张) |
| `topicunhideplatformshare` | 话题平台分成 | 否 |
| `tag` | 标签表 | 否 |

**topic表核心字段：**
```sql
CREATE TABLE `topic` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `title` varchar(190) NULL,                   -- 标题
  `content` longtext NULL,                     -- 内容（HTML）
  `markdownContent` longtext NULL,             -- Markdown原文
  `userName` varchar(30) NULL,                 -- 作者用户名
  `postTime` datetime(6) NULL,                 -- 发布时间
  `lastReplyTime` datetime(6) NULL,            -- 最后回复时间
  `lastUpdateTime` datetime(6) NULL,           -- 最后更新时间
  `viewTotal` bigint NULL,                     -- 浏览量
  `commentTotal` bigint NULL,                  -- 评论数
  `status` int NULL,                           -- 状态（20-已发布）
  `essence` bit(1) NULL,                       -- 是否精华
  `weight` double NULL,                        -- 权重/热度
  `sort` int NULL,                             -- 排序
  `tagId` bigint NULL,                         -- 主标签ID
  `tagIdGroup` varchar(50) NULL,               -- 标签组（如：,0,123,456,）
  `giveRedEnvelopeId` varchar(32) NULL,        -- 红包ID
  `voteThemeId` varchar(32) NULL,              -- 投票主题ID
  `isMarkdown` bit(1) NULL,                    -- 是否Markdown格式
  `isStaff` bit(1) NULL,                       -- 是否员工发布
  `ip` varchar(45) NULL,                       -- 发布IP
  `image` longtext NULL,                       -- 图片列表
  `summary` longtext NULL,                     -- 摘要
  `allow` bit(1) NOT NULL,                     -- 是否允许评论
  PRIMARY KEY (`id`)
);
```

**关键特性：**
- ✅ Markdown支持
- ✅ 红包功能
- ✅ 投票功能
- ✅ 精华标记
- ✅ 权重排序（热度算法）
- ✅ 多标签支持
- ✅ 图片上传
- ✅ 自动摘要

---

### 2.3 评论回复系统

**表数量：** 15张表

| 表名 | 功能说明 | 分表 |
|------|---------|------|
| `comment` | 评论主表 | 否 |
| `commentlike_0~3` | 评论点赞记录 | 是(4张) |
| `commentreplylike_0~3` | 评论回复点赞 | 是(4张) |
| `reply` | 回复表（楼中楼） | 否 |
| `customreply` | 自定义快捷回复模板 | 否 |

**comment表核心字段：**
```sql
CREATE TABLE `comment` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `topicId` bigint NULL,                       -- 关联话题ID
  `content` longtext NULL,                     -- 评论内容
  `userName` varchar(30) NULL,                 -- 评论者
  `postTime` datetime(6) NULL,                 -- 发布时间
  `status` int NULL,                           -- 状态
  `ip` varchar(45) NULL,                       -- IP地址
  `isStaff` bit(1) NULL,                       -- 是否员工
  `likeCount` bigint NULL,                     -- 点赞数
  PRIMARY KEY (`id`)
);
```

---

### 2.4 问答系统

**表数量：** 20+张表

| 表名 | 功能说明 | 分表 |
|------|---------|------|
| `question` | 问题主表 | 否 |
| `questionindex` | 问题全文搜索索引 | 否 |
| `questiontag` | 问题标签 | 否 |
| `questiontagassociation` | 问题-标签关联 | 否 |
| `questionlike_0~3` | 问题点赞记录 | 是(4张) |
| `questionfavorite_0~3` | 问题收藏记录 | 是(4张) |
| `questionrewardplatformshare` | 悬赏平台分成 | 否 |
| `answer` | 答案表 | 否 |
| `answerreply` | 答案回复 | 否 |
| `answerlike_0~3` | 答案点赞 | 是(4张) |
| `answerreplylike_0~3` | 答案回复点赞 | 是(4张) |

**question表核心字段：**
```sql
CREATE TABLE `question` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `title` varchar(190) NULL,                   -- 问题标题
  `content` longtext NULL,                     -- 问题内容
  `userName` varchar(30) NULL,                 -- 提问者
  `postTime` datetime(6) NULL,                 -- 发布时间
  `answerTotal` bigint NULL,                   -- 答案数
  `viewTotal` bigint NULL,                     -- 浏览量
  `status` int NULL,                           -- 状态
  `adoptionAnswerId` bigint NULL,              -- 采纳的答案ID
  PRIMARY KEY (`id`)
);
```

**关键特性：**
- ✅ 悬赏问答
- ✅ 答案采纳
- ✅ 平台分成
- ✅ 标签系统

---

### 2.5 社交系统

**表数量：** 12张表

| 表名 | 功能说明 | 分表 |
|------|---------|------|
| `follow_0~3` | 关注列表 | 是(4张) |
| `follower_0~3` | 粉丝列表 | 是(4张) |
| `like_0~3` | 通用点赞记录 | 是(4张) |
| `favorites_0~3` | 收藏夹 | 是(4张) |

**分表策略：**
- 所有社交表都按 `_0, _1, _2, _3` 分成4张表
- 基于 userId 的hash值进行分表路由
- 有效分散热点数据，提升查询性能

**follow表结构：**
```sql
CREATE TABLE `follow_0` (
  `id` varchar(40) NOT NULL,
  `addtime` datetime(6) NULL,                  -- 关注时间
  `followUserName` varchar(30) NULL,           -- 被关注的用户
  `userName` varchar(30) NULL,                 -- 关注者
  PRIMARY KEY (`id`)
);
```

---

### 2.6 消息通知系统

**表数量：** 12张表

| 表名 | 功能说明 | 分表 |
|------|---------|------|
| `remind_0~3` | 提醒消息（评论、点赞等） | 是(4张) |
| `privatemessage_0~3` | 私信 | 是(4张) |
| `systemnotify` | 系统通知 | 否 |
| `subscriptionsystemnotify_0~3` | 系统通知订阅 | 是(4张) |

**remind表核心字段：**
```sql
CREATE TABLE `remind_0` (
  `id` varchar(36) NOT NULL,
  `receiverUserId` bigint NULL,                -- 接收者ID
  `senderUserId` bigint NULL,                  -- 发送者ID
  `content` varchar(1000) NULL,                -- 提醒内容
  `type` int NULL,                             -- 类型（评论、点赞等）
  `status` int NULL,                           -- 状态（未读/已读）
  `topicId` bigint NULL,                       -- 关联话题ID
  `postTime` datetime(6) NULL,                 -- 发送时间
  `readTime` datetime(6) NULL,                 -- 阅读时间
  PRIMARY KEY (`id`)
);
```

**消息类型：**
- 评论提醒
- 点赞提醒
- 关注提醒
- 系统通知
- 私信

---

### 2.7 支付金融系统

**表数量：** 15张表

| 表名 | 功能说明 | 分表 |
|------|---------|------|
| `pointlog_0~3` | 积分日志 | 是(4张) |
| `paymentlog_0~3` | 支付日志 | 是(4张) |
| `paymentverificationlog` | 支付验证日志 | 否 |
| `onlinepaymentinterface` | 在线支付接口配置 | 否 |
| `giveredenvelope` | 发红包记录 | 否 |
| `receiveredenvelope_0~3` | 领红包记录 | 是(4张) |
| `membershipcard` | 会员卡 | 否 |
| `membershipcardorder` | 会员卡订单 | 否 |
| `membershipcardgiftitem_0~3` | 会员礼包 | 是(4张) |
| `membershipcardgifttask` | 会员礼包任务 | 否 |

**pointlog表核心字段：**
```sql
CREATE TABLE `pointlog_0` (
  `id` varchar(36) NOT NULL,
  `operationDate` datetime(6) NULL,            -- 操作时间
  `point` bigint NULL,                         -- 积分变动数量
  `pointType` int NULL,                        -- 积分类型
  `remark` varchar(255) NULL,                  -- 备注
  `userId` bigint NULL,                        -- 用户ID
  PRIMARY KEY (`id`)
);
```

**金融功能：**
- ✅ 积分系统（赚取、消费、过期）
- ✅ 红包功能（发红包、抢红包）
- ✅ 会员卡系统（购买、续费、权益）
- ✅ 在线支付（支付宝、微信等）
- ✅ 支付验证（回调验证）

---

### 2.8 内容管理系统

**表数量：** 10张表

| 表名 | 功能说明 |
|------|---------|
| `forum` | 版块管理 |
| `help` | 帮助文档 |
| `helptype` | 帮助分类 |
| `links` | 友情链接 |
| `layout` | 页面布局配置 |
| `templates` | 页面模板 |
| `specification` | 平台规范说明 |

**forum表核心字段：**
```sql
CREATE TABLE `forum` (
  `id` bigint NOT NULL AUTO_INCREMENT,
  `dirName` varchar(50) NULL,                  -- 目录名（URL路径）
  `forumChildTypeId` varchar(60) NULL,         -- 子版块ID组
  `forumChildTypeName` longtext NULL,          -- 子版块名称组
  `image` longtext NULL,                       -- 版块图片
  `isLeaf` bit(1) NOT NULL,                    -- 是否叶子节点
  `junctionData` longtext NULL,                -- 关联数据
  `module` int NULL,                           -- 模块类型
  `name` varchar(50) NULL,                     -- 版块名称
  `parentId` bigint NULL,                      -- 父版块ID
  `sort` int NULL,                             -- 排序
  PRIMARY KEY (`id`)
);
```

---

### 2.9 系统管理模块

**表数量：** 15张表

| 表名 | 功能说明 |
|------|---------|
| `sysusers` | 系统用户（管理员） |
| `sysroles` | 系统角色 |
| `sysusersroles` | 用户-角色关联表 |
| `syspermission` | 权限表 |
| `sysrolespermission` | 角色-权限关联表 |
| `sysresources` | 资源表（菜单） |
| `syspermissionresources` | 权限-资源关联表 |
| `staffloginlog_0~3` | 员工登录日志 |
| `systemsetting` | 系统设置 |
| `upgradesystem` | 系统升级记录 |
| `timetask` | 定时任务 |

**RBAC权限模型：**
```
用户(Users) → 角色(Roles) → 权限(Permission) → 资源(Resources)
     ↓             ↓              ↓                  ↓
  sysusers    sysroles    syspermission        sysresources
              ↓                   ↓                  ↓
         sysusersroles    sysrolespermission  syspermissionresources
```

**systemsetting表示例：**
- 网站标题、描述、关键词
- SMTP邮件配置
- 短信接口配置
- 支付接口配置
- 文件上传配置
- 缓存配置

---

### 2.10 第三方集成模块

**表数量：** 8张表

| 表名 | 功能说明 |
|------|---------|
| `thirdpartylogininterface` | 第三方登录（微信、QQ、微博等） |
| `aiinterface` | AI接口配置 |
| `smsinterface` | 短信接口配置 |
| `sendsmslog` | 短信发送日志 |
| `emailsetting` | 邮件设置 |

**支持的第三方平台：**
- 🔐 微信登录
- 🔐 QQ登录
- 🔐 微博登录
- 🤖 AI接口（ChatGPT等）
- 📱 短信服务（阿里云、腾讯云等）
- 📧 邮件服务（SMTP）

---

### 2.11 内容安全模块

**表数量：** 5张表

| 表名 | 功能说明 |
|------|---------|
| `report` | 举报记录 |
| `reporttype` | 举报类型 |
| `disableusername` | 禁用用户名（黑名单） |
| `feedback` | 用户反馈 |

**report表核心字段：**
```sql
CREATE TABLE `report` (
  `id` varchar(36) NOT NULL,
  `answerId` bigint NULL,                      -- 答案ID
  `commentId` bigint NULL,                     -- 评论ID
  `content` longtext NULL,                     -- 举报说明
  `postUserName` varchar(30) NULL,             -- 被举报用户
  `questionId` bigint NULL,                    -- 问题ID
  `reportTypeId` int NULL,                     -- 举报类型
  `status` int NULL,                           -- 处理状态
  `topicId` bigint NULL,                       -- 话题ID
  `userName` varchar(30) NULL,                 -- 举报人
  PRIMARY KEY (`id`)
);
```

**举报类型：**
- 垃圾广告
- 违规内容
- 不实信息
- 侵权内容
- 其他违规

---

### 2.12 媒体处理模块

**表数量：** 4张表

| 表名 | 功能说明 |
|------|---------|
| `mediaprocessqueue` | 媒体处理队列（异步任务） |
| `mediaprocesssetting` | 媒体处理设置 |
| `thumbnail` | 缩略图管理 |

**功能：**
- 图片压缩
- 缩略图生成
- 视频转码
- 水印添加

---

### 2.13 统计分析模块

**表数量：** 2张表

| 表名 | 功能说明 |
|------|---------|
| `pv` | 页面浏览量统计 |
| `timetask` | 定时任务（数据统计、清理等） |

---

## 3. 数据库设计特点

### ✅ 优点

#### 1. 水平分表策略
```
高频访问表分成4张表：_0, _1, _2, _3
- 点赞表：like_0, like_1, like_2, like_3
- 关注表：follow_0, follow_1, follow_2, follow_3
- 私信表：privatemessage_0, privatemessage_1, privatemessage_2, privatemessage_3
```
**优势：**
- 分散数据压力
- 提升查询性能
- 降低单表数据量

#### 2. 完整的索引设计
```sql
-- 主键索引
PRIMARY KEY (`id`)

-- 唯一索引
UNIQUE INDEX `UKdnq7r8jcmlft7l8l4j79l1h74`(`account`)

-- 普通索引
INDEX `user_idx`(`state`)

-- 组合索引
INDEX `topic_5_idx`(`status`, `sort`, `lastReplyTime`)
```

#### 3. 字符集选择
- 统一使用 `utf8mb4` 字符集
- 排序规则：`utf8mb4_0900_ai_ci`
- 支持emoji表情和特殊字符

#### 4. 业务字段丰富
- **时间戳：** postTime, lastReplyTime, registrationDate
- **统计字段：** viewTotal, commentTotal, likeCount
- **状态字段：** status, state
- **权重字段：** weight, sort

#### 5. 扩展性设计
- `usercustom`、`userinputvalue` 支持自定义字段
- `layout`、`templates` 支持页面定制
- `systemsetting` 支持动态配置

---

### ⚠️ 可优化点

#### 1. 分表数量固定
**问题：** 目前固定为4张分表，无法动态扩展

**建议：**
- 使用分库分表中间件（如ShardingSphere、MyCat）
- 支持动态增加分表数量
- 实现数据自动迁移

#### 2. 部分表字段冗余
**问题：** 某些表存在字段冗余，影响存储效率

**建议：**
- 定期审查表结构
- 将不常用字段拆分到扩展表
- 使用JSON字段存储动态属性

#### 3. 缺少软删除标记
**问题：** 部分表直接物理删除数据，无法恢复

**建议：**
- 增加 `deleted` 字段实现软删除
- 定期归档已删除数据
- 保留数据审计记录

#### 4. 时间字段精度过高
**问题：** 使用 `datetime(6)` 精度到微秒，可能不必要

**建议：**
- 评估是否需要微秒级精度
- 考虑使用 `datetime(3)` 毫秒级精度
- 或使用 `datetime` 秒级精度

---

## 4. 表数量统计

| 模块 | 表数量 | 占比 | 关键表 |
|------|--------|------|--------|
| 用户系统 | 10 | 7% | user, userdynamic_*, userloginlog_* |
| 话题/帖子 | 20+ | 14% | topic, topiclike_*, topicfavorite_* |
| 问答系统 | 20+ | 14% | question, answer, questionlike_* |
| 社交功能 | 12 | 9% | follow_*, follower_*, like_* |
| 消息通知 | 12 | 9% | remind_*, privatemessage_* |
| 支付金融 | 15 | 11% | pointlog_*, paymentlog_*, membershipcard |
| 系统管理 | 15 | 11% | sysusers, sysroles, syspermission |
| 内容管理 | 10 | 7% | forum, help, templates |
| 第三方集成 | 8 | 6% | thirdpartylogininterface, aiinterface |
| 内容安全 | 5 | 4% | report, reporttype |
| 媒体处理 | 4 | 3% | mediaprocessqueue, thumbnail |
| 统计分析 | 2 | 1% | pv, timetask |
| 其他功能 | 7 | 4% | links, specification |
| **总计** | **140+** | **100%** | - |

---

## 5. 核心表结构详解

### 5.1 user（用户表）

**功能：** 存储用户基本信息

**完整字段列表：**
```sql
CREATE TABLE `user` (
  `id` bigint NOT NULL AUTO_INCREMENT,         -- 用户ID（主键）
  `account` varchar(65) NULL UNIQUE,           -- 账号（唯一）
  `userName` varchar(30) NULL,                 -- 用户名
  `nickname` varchar(50) NULL,                 -- 昵称
  `email` varchar(100) NULL,                   -- 邮箱
  `mobile` varchar(20) NULL,                   -- 手机号
  `password` varchar(160) NULL,                -- 密码（SHA-256加密）
  `salt` varchar(80) NULL,                     -- 密码盐
  `point` bigint NULL DEFAULT 0,               -- 积分
  `deposit` decimal(14,4) NULL DEFAULT 0,      -- 保证金
  `state` int NULL DEFAULT 1,                  -- 状态（1-正常, 2-禁用）
  `type` int NULL DEFAULT 10,                  -- 类型（10-普通用户, 20-VIP）
  `registrationDate` datetime(6) NULL,         -- 注册时间
  `realNameAuthentication` bit(1) NOT NULL,    -- 是否实名认证
  `platformUserId` varchar(90) NULL UNIQUE,    -- 第三方平台用户ID
  `cancelAccountTime` bigint NULL DEFAULT -1,  -- 注销时间戳（-1表示未注销）
  `avatarName` varchar(50) NULL,               -- 头像文件名
  `issue` varchar(50) NULL,                    -- 密保问题
  `answer` varchar(80) NULL,                   -- 密保答案
  `remarks` longtext NULL,                     -- 备注
  `securityDigest` bigint NULL,                -- 安全摘要
  `userVersion` int NULL DEFAULT 1,            -- 用户版本号
  `allowUserDynamic` bit(1) NULL DEFAULT 1,    -- 是否允许显示动态
  PRIMARY KEY (`id`),
  UNIQUE INDEX (`account`),
  UNIQUE INDEX (`platformUserId`),
  INDEX (`state`),
  INDEX (`userName`),
  INDEX (`nickname`),
  INDEX (`mobile`),
  INDEX (`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**索引说明：**
- 主键索引：id（自增）
- 唯一索引：account, platformUserId
- 普通索引：state, userName, nickname, mobile, email

**业务规则：**
- 注册时必填：account, userName, password
- 账号和platformUserId必须唯一
- state=1为正常，state=2为禁用
- cancelAccountTime=-1表示未注销

---

### 5.2 topic（话题表）

**功能：** 存储论坛话题/帖子

**完整字段列表：**
```sql
CREATE TABLE `topic` (
  `id` bigint NOT NULL AUTO_INCREMENT,         -- 话题ID（主键）
  `title` varchar(190) NULL,                   -- 标题
  `content` longtext NULL,                     -- 内容（HTML格式）
  `markdownContent` longtext NULL,             -- Markdown原文
  `summary` longtext NULL,                     -- 摘要
  `image` longtext NULL,                       -- 图片列表（JSON数组）
  `userName` varchar(30) NULL,                 -- 作者用户名
  `postTime` datetime(6) NULL,                 -- 发布时间
  `lastReplyTime` datetime(6) NULL,            -- 最后回复时间
  `lastUpdateTime` datetime(6) NULL,           -- 最后更新时间
  `viewTotal` bigint NULL DEFAULT 0,           -- 浏览量
  `commentTotal` bigint NULL DEFAULT 0,        -- 评论数
  `status` int NULL DEFAULT 10,                -- 状态（10-草稿, 20-已发布）
  `essence` bit(1) NULL DEFAULT 0,             -- 是否精华
  `weight` double NULL DEFAULT 0,              -- 权重/热度
  `sort` int NULL DEFAULT 0,                   -- 排序（0-普通, 100-置顶）
  `tagId` bigint NULL,                         -- 主标签ID
  `tagIdGroup` varchar(50) NULL,               -- 标签ID组（如：,0,123,456,）
  `giveRedEnvelopeId` varchar(32) NULL,        -- 红包ID
  `voteThemeId` varchar(32) NULL,              -- 投票主题ID
  `isMarkdown` bit(1) NULL DEFAULT 0,          -- 是否Markdown格式
  `isStaff` bit(1) NULL DEFAULT 0,             -- 是否员工发布
  `ip` varchar(45) NULL,                       -- 发布IP地址
  `allow` bit(1) NOT NULL DEFAULT 1,           -- 是否允许评论
  PRIMARY KEY (`id`),
  INDEX (`userName`, `postTime`),
  INDEX (`status`, `sort`, `lastReplyTime`),
  INDEX (`weight`),
  INDEX (`tagIdGroup`, `status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

**状态说明：**
- 10：草稿（未发布）
- 20：已发布
- 30：已删除
- 40：已锁定

**权重计算：**
```
weight = (viewTotal * 0.1) + (commentTotal * 0.5) + (时间衰减因子)
```

---

### 5.3 comment（评论表）

**功能：** 存储话题评论

**完整字段列表：**
```sql
CREATE TABLE `comment` (
  `id` bigint NOT NULL AUTO_INCREMENT,         -- 评论ID（主键）
  `topicId` bigint NULL,                       -- 关联话题ID
  `content` longtext NULL,                     -- 评论内容
  `userName` varchar(30) NULL,                 -- 评论者用户名
  `postTime` datetime(6) NULL,                 -- 发布时间
  `status` int NULL DEFAULT 20,                -- 状态（20-已发布）
  `ip` varchar(45) NULL,                       -- IP地址
  `isStaff` bit(1) NULL DEFAULT 0,             -- 是否员工
  `likeCount` bigint NULL DEFAULT 0,           -- 点赞数
  PRIMARY KEY (`id`),
  INDEX (`topicId`, `postTime`),
  INDEX (`userName`, `postTime`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

---

### 5.4 question（问题表）

**功能：** 存储问答系统的问题

**完整字段列表：**
```sql
CREATE TABLE `question` (
  `id` bigint NOT NULL AUTO_INCREMENT,         -- 问题ID（主键）
  `title` varchar(190) NULL,                   -- 问题标题
  `content` longtext NULL,                     -- 问题内容
  `userName` varchar(30) NULL,                 -- 提问者
  `postTime` datetime(6) NULL,                 -- 发布时间
  `answerTotal` bigint NULL DEFAULT 0,         -- 答案数
  `viewTotal` bigint NULL DEFAULT 0,           -- 浏览量
  `status` int NULL DEFAULT 20,                -- 状态
  `adoptionAnswerId` bigint NULL,              -- 采纳的答案ID
  `point` bigint NULL DEFAULT 0,               -- 悬赏积分
  PRIMARY KEY (`id`),
  INDEX (`userName`, `postTime`),
  INDEX (`status`, `postTime`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

---

## 6. 数据备份建议

### 6.1 按优先级分类

#### 🔴 高优先级（核心数据，必须备份）
```
✅ user                    -- 用户信息
✅ topic                   -- 话题内容
✅ comment                 -- 评论
✅ reply                   -- 回复
✅ question                -- 问题
✅ answer                  -- 答案
✅ forum                   -- 版块
✅ tag                     -- 标签
```

#### 🟡 中优先级（业务数据，建议备份）
```
⚠️ userdynamic_*          -- 用户动态
⚠️ topiclike_*            -- 话题点赞
⚠️ topicfavorite_*        -- 话题收藏
⚠️ questionlike_*         -- 问题点赞
⚠️ questionfavorite_*     -- 问题收藏
⚠️ follow_*               -- 关注关系
⚠️ follower_*             -- 粉丝关系
⚠️ pointlog_*             -- 积分记录
⚠️ paymentlog_*           -- 支付记录
⚠️ membershipcard         -- 会员卡
⚠️ remind_*               -- 提醒消息
⚠️ privatemessage_*       -- 私信
```

#### ⚪ 低优先级（可选备份）
```
○ userloginlog_*          -- 登录日志（可定期清理）
○ staffloginlog_*         -- 员工登录日志
○ pv                      -- 浏览量统计（可重新统计）
○ sendsmslog              -- 短信日志（可定期清理）
○ *setting                -- 配置表（可单独备份）
○ *interface              -- 接口配置（可单独备份）
```

---

### 6.2 备份策略建议

#### 完整备份（每周）
```bash
# 备份所有表
mysqldump -u root -p bbs-pro > bbs-pro-full-$(date +%Y%m%d).sql
```

#### 增量备份（每天）
```bash
# 只备份有变化的数据
mysqlbinlog --start-datetime="2025-11-01 00:00:00" \
            --stop-datetime="2025-11-01 23:59:59" \
            /var/log/mysql/mysql-bin.000001 > incremental-$(date +%Y%m%d).sql
```

#### 核心表备份（实时）
```bash
# 只备份核心业务表
mysqldump -u root -p bbs-pro \
  user topic comment reply question answer \
  > bbs-pro-core-$(date +%Y%m%d-%H%M%S).sql
```

---

### 6.3 CSV导出建议

**适合CSV格式的表：**
- ✅ 数据量适中（< 100万行）
- ✅ 字段类型简单（避免复杂的JSON、BLOB）
- ✅ 需要人工查看或编辑

**推荐导出为CSV：**
```
user                      -- 用户列表（方便Excel查看）
topic                     -- 话题列表（内容预览）
tag                       -- 标签管理
forum                     -- 版块管理
usergrade                 -- 等级配置
membershipcard            -- 会员卡配置
```

**不推荐CSV格式：**
```
❌ *log_* 表              -- 日志数据量大，建议SQL格式
❌ *like_* 表             -- 点赞记录多，建议SQL格式
❌ remind_* 表            -- 消息数据多，建议SQL格式
```

---

### 6.4 数据恢复测试

**建议每月进行恢复测试：**
1. 在测试环境恢复备份数据
2. 验证数据完整性
3. 检查业务功能是否正常
4. 记录恢复时间和问题

---

## 附录

### A. 完整表列表（按字母排序）

```
1.  aiinterface                    36. membershipcardgiftitem_0
2.  answer                         37. membershipcardgiftitem_1
3.  answerlike_0                   38. membershipcardgiftitem_2
4.  answerlike_1                   39. membershipcardgiftitem_3
5.  answerlike_2                   40. membershipcardgifttask
6.  answerlike_3                   41. membershipcardorder
7.  answerreply                    42. onlinepaymentinterface
8.  answerreplylike_0              43. paymentlog_0
9.  answerreplylike_1              44. paymentlog_1
10. answerreplylike_2              45. paymentlog_2
11. answerreplylike_3              46. paymentlog_3
12. comment                        47. paymentverificationlog
13. commentlike_0                  48. pointlog_0
14. commentlike_1                  49. pointlog_1
15. commentlike_2                  50. pointlog_2
16. commentlike_3                  51. pointlog_3
17. commentreplylike_0             52. privatemessage_0
18. commentreplylike_1             53. privatemessage_1
19. commentreplylike_2             54. privatemessage_2
20. commentreplylike_3             55. privatemessage_3
21. customreply                    56. pv
22. disableusername                57. question
23. emailsetting                   58. questionfavorite_0
24. favorites_0                    59. questionfavorite_1
25. favorites_1                    60. questionfavorite_2
26. favorites_2                    61. questionfavorite_3
27. favorites_3                    62. questionindex
28. feedback                       63. questionlike_0
29. follow_0                       64. questionlike_1
30. follow_1                       65. questionlike_2
31. follow_2                       66. questionlike_3
32. follow_3                       67. questionrewardplatformshare
33. follower_0                     68. questiontag
34. follower_1                     69. questiontagassociation
35. follower_2                     70. receiveredenvelope_0
36. follower_3                     71. receiveredenvelope_1
37. forum                          72. receiveredenvelope_2
38. giveredenvelope                73. receiveredenvelope_3
39. help                           74. remind_0
40. helptype                       75. remind_1
41. layout                         76. remind_2
42. like_0                         77. remind_3
43. like_1                         78. reply
44. like_2                         79. report
45. like_3                         80. reporttype
46. links                          81. sendsmslog
47. mediaprocessqueue              82. smsinterface
48. mediaprocesssetting            83. specification
49. membershipcard                 84. staffloginlog_0
50. membershipcardgiftitem_0       85. staffloginlog_1
51. membershipcardgiftitem_1       86. staffloginlog_2
52. membershipcardgiftitem_2       87. staffloginlog_3
53. membershipcardgiftitem_3       88. subscriptionsystemnotify_0
54. membershipcardgifttask         89. subscriptionsystemnotify_1
55. membershipcardorder            90. subscriptionsystemnotify_2
56. onlinepaymentinterface         91. subscriptionsystemnotify_3
57. paymentlog_0                   92. syspermission
58. paymentlog_1                   93. syspermissionresources
59. paymentlog_2                   94. sysresources
60. paymentlog_3                   95. sysroles
61. paymentverificationlog         96. sysrolespermission
62. pointlog_0                     97. systemnotify
63. pointlog_1                     98. systemsetting
64. pointlog_2                     99. sysusers
65. pointlog_3                     100. sysusersroles
66. privatemessage_0               101. tag
67. privatemessage_1               102. templates
68. privatemessage_2               103. thirdpartylogininterface
69. privatemessage_3               104. thumbnail
70. pv                             105. timetask
71. question                       106. topic
72. questionfavorite_0             107. topicfavorite_0
73. questionfavorite_1             108. topicfavorite_1
74. questionfavorite_2             109. topicfavorite_2
75. questionfavorite_3             110. topicfavorite_3
76. questionindex                  111. topicindex
77. questionlike_0                 112. topiclike_0
78. questionlike_1                 113. topiclike_1
79. questionlike_2                 114. topiclike_2
80. questionlike_3                 115. topiclike_3
81. questionrewardplatformshare    116. topicunhide_0
82. questiontag                    117. topicunhide_1
83. questiontagassociation         118. topicunhide_2
84. receiveredenvelope_0           119. topicunhide_3
85. receiveredenvelope_1           120. topicunhideplatformshare
86. receiveredenvelope_2           121. upgradesystem
87. receiveredenvelope_3           122. user
88. remind_0                       123. usercustom
89. remind_1                       124. userdynamic_0
90. remind_2                       125. userdynamic_1
91. remind_3                       126. userdynamic_2
92. reply                          127. userdynamic_3
93. report                         128. usergrade
94. reporttype                     129. userinputvalue
95. sendsmslog                     130. userloginlog_0
96. smsinterface                   131. userloginlog_1
97. specification                  132. userloginlog_2
98. staffloginlog_0                133. userloginlog_3
99. staffloginlog_1                134. userrole
100. staffloginlog_2               135. userrolegroup
```

---

**文档版本：** v1.0  
**最后更新：** 2025年11月1日  
**作者：** github copilot

---
